<!DOCTYPE html>

<html>
<head>
    <title>AQI</title>
    <link rel="stylesheet" type="text/css" href="fonts.css">
	<link rel="stylesheet" type="text/css" href="style.css">
	<link rel="stylesheet" type="text/css" href="multirange.css">
</head>

<body onload="initSliders()">
	
	<!--<header class="hugo-background">-->
	<!--	<div class="container center white">-->
	<!--		<h1 class="highlight">-->
	<!--			Air quality in Beijing: clearing up?	-->
	<!--		</h1>-->
	<!--		<!--<h2>-->
	<!--			Exploring the air quality in Beijing and other parts of the world.-->
	<!--		</h2>-->
	<!--	</div>-->
	<!--</header>-->
	
	<header class="sky-background">
		<div class="container center">
			<h1 class="white">
				Air quality in Beijing: clearing up?
			</h1>
			<!--<h2>-->
			<!--	Exploring the air quality in Beijing and other parts of the world.-->
			<!--</h2>-->
		</div>
	</header>
	
	<div class="container center">
		<div class="sky-header">
			<span>photo by <a href="https://unsplash.com/photos/HIwWAzwbdG0">Peiheng Yang</a></span>
		</div>
	</div>
	
	<section class="section">
		
		<div class="container center">
			
			<!--<h3>-->
			<!--	This is a (air) quality investigation.-->
			<!--</h3>-->
			<div class="paragraph">
				<h3>
					In Beijing, the AQI is the weather.
				</h3>
				<!--<p>
					Before moving here, I never worried about air quality. In Beijing, it's different. You know you've been here for a while if the first thing you do when you arrive in another country is checking the AQI (Air Quality Index).
				</p>-->
				<p>
					Where people elsewhere are obsessed with the weather, here it's all about AQI. Possibly because, save air quality, the forecast is straightforward; scorching hot or freezing, with a few weeks of spring or fall in between.
				</p>
				<p>
					The AQI can make or break your day. What could have been a perfect day for lounging at the pool becomes a sad Saturday spent inside, on a 'bad airday'.
				</p>
				<!--<p>-->
				<!--	At Xiaomi, I worked on the India launch of the Mi Air Purifier 2. The launch event was set to happen in Delhi, which in recent years has come to rival Beijing in terms of air pollution. In the launch presentation, we compared the air quality in Beijing, Delhi, and San Francisco. I had already worked on <a href="http://seriousness.nl/wake_me_run_run.html" target="_blank">an AQI based alarm app</a> with a friend, but what really sparked my interest was finding out that several organizations publish air quality data online. -->
				<!--</p>-->
				<p>
					
				</p>
			</div>
		</div>
		
	</section>
	
	<!--<div class="flexbox-container">-->
	<!--	<div>-->
	<!--		<div class="hugo-caption">-->
	<!--				<h3 class="bad-air">-->
	<!--					A bad air day in Beijing.-->
	<!--				</h3>-->
	<!--				<p>-->
	<!--					Taken from the Mi Air Purifier 2 launch deck, here we have Hugo Barra wearing an air pollution mask on a less than ideal air day in Beijing.-->
	<!--				</p>-->
	<!--				<p class="small">-->
	<!--					(Photo by yours truly)-->
	<!--				</p>-->
	<!--		</div>-->
	<!--	</div>-->
	<!--	<div>-->
	<!--		<div class="image70">-->
	<!--			<img src="img/hugo_mask.jpg"/>-->
	<!--		-->
	<!--		</div>-->
	<!--	</div>-->
	<!--</div>-->
	
	<section class="hugo-background">
        <div class="hugo-overlay">
            <h2 class="bad-air-day">
                <span class="black-bkg">A bad air day in Beijing.</span>
            </h3>
            <p>
                 <span class="black-bkg">Taken from the Mi Air Purifier 2 launch deck: Hugo Barra wearing an air pollution mask on a less than ideal air day in Beijing.</span>
            </p>
            <!--<h4>-->
            <!--    <span>AQI level: </span><span class="bad">BAD</span>-->
            <!--</h4>-->
            <p class="small">
                (Photo by yours truly)
            </p>
		</div>
	</section>
	
	
			<!--<div class="half-width left">-->
			<!--	<div class="block">-->
			<!--		<h3>-->
			<!--			Getting the data-->
			<!--		</h3>-->
			<!--		<p class="paragraph">-->
			<!--			The US Embassy in Beijing has been collecting <a href="http://stateair.net/web/historical/1/1.html" target="_blank">hourly pm2.5 data</a> since 2008. Sadly, they haven't published any data since June 2017. However, Berkeley Earth has been collecting <a href="http://berkeleyearth.lbl.gov/air-quality/local/China/Beijing/Beijing" target="_blank">pm2.5 data since 2014</a>, and their data is current. </br></br>So, is the air getting better or what?-->
			<!--		</p>-->
			<!--	</div>-->
			<!--</div>-->
		
			
					
					<!--<ol class="large">-->
					<!--	<li>-->
					<!--		Is the air getting better in Beijing?-->
					<!--	</li>-->
						<!--<li>
							What's the best time to get out of the city? What's the best time of year to stay in (or visit) Beijing and enjoy clean air?
						</li>
						<li>
							How does the air quality in Beijing fluctuate throughout the day? How does that impact daily life?
						</li>
						<li>
							How does Beijing air compare to other parts of the world?
						</li>
						<li>
							What can we say about factors that influence air quality in Beijing? Do cars play a big role? What about factories/coal plants? Wind? Rain? Temperature? Government? National holidays? Seasons?
						</li>-->
					
	
	
	<section class="section gray">
        <div class="container center row">
            <div class="column-1">
                <div class="block">
					<h3>
						How many bad days?
					</h3>
					<p class="paragraph">
						The US Embassy in Beijing has been collecting <a href="http://stateair.net/web/historical/1/1.html" target="_blank">hourly pm2.5 data</a> since 2008. Sadly, they haven't published any data since June 2017. However, Berkeley Earth has been collecting <a href="http://berkeleyearth.lbl.gov/air-quality/local/China/Beijing/Beijing" target="_blank">pm2.5 data since 2014</a>, and their data is current. 
					</p>
				</div>
				<div id="sliders">
					<h4 class="sliders-title">
						What's a bad air day? 
					</h4>
					<p>
						According to the XYZ, a day where the pm2.5 level exceeds 60 for more than 8 hours is considered bad. 
					</p>
					<p>
						Drag the sliders to define your own bad air day. 
					</p>
					<div id="aqi-rectangle"></div>
					<div id="sky-rectangle"></div>
					<div class="sliders-container">
						<div class="aqi-slider-container">
							<input id="slider-AQI" type="range" min="0" max="600" step="1" value="150" list="tickmarks">
							<datalist id="tickmarks">
								<option value="0" label="0%">
								<option value="50">
								<option value="100">
								<option value="150">
								<option value="200">
								<option value="250" label="50%">
								<option value="300">
								<option value="350">
								<option value="400">
								<option value="450">
								<option value="500">
								<option value="550">
								<option value="600" label="100%">
							</datalist>
						</div>
						
						<div class="horizontal-slider">
							<input class="slider-hours" type="range" multiple value="9,17" min="0" max="24" step="1" list="tickmarks-hours">
								<!--<datalist id="tickmarks-hours">
									<option value="0">
									<option value="1">
									<option value="2">
									<option value="3">
									<option value="4">
									<option value="5">
									<option value="6">
									<option value="7">
									<option value="8">
									<option value="9">
									<option value="10">
									<option value="11">
									<option value="12">
									<option value="13">
									<option value="14">
									<option value="15">
									<option value="16">
									<option value="17">
									<option value="18">
									<option value="19">
									<option value="20">
									<option value="21">
									<option value="22">
									<option value="23">
									<option value="24">
								</datalist>-->
							<div id="low-hrs" class="slider-label">0</div>
							<div id="high-hrs" class="slider-label">24</div>
						</div>
					</div>

					<div id="max-aqi" class="slider-label">150</div>
					<!--<div id="max-hrs">5</div>-->

				</div>
				
			</div>
            
            <div class="column-2">
                 <div class="bad-conditions-label">
                    <span id="max-hrs">5</span>
                    <span> hours of PM2.5 above </span>
                    <span id="max-aqi-value">150</span>
                </div>
                <div class="bars-container">
                    <div class="spacer-block"></div>
                    <!--<div class="bad-conditions-label">-->
                    <!--    <span id="max-hrs">5 </span>-->
                    <!--    <span>hours of PM2.5 above </span>-->
                    <!--    <span id="max-aqi-value">150</span>-->
                    <!--</div>-->
                    
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2009"></div>
                        <div class="bar" id="bad-days-2009-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2010"></div>
                        <div class="bar" id="bad-days-2010-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2011"></div>
                        <div class="bar" id="bad-days-2011-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2012"></div>
                        <div class="bar" id="bad-days-2012-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2013"></div>
                        <div class="bar" id="bad-days-2013-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2014"></div>
                        <div class="bar" id="bad-days-2014-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2015"></div>
                        <div class="bar" id="bad-days-2015-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2016"></div>
                        <div class="bar" id="bad-days-2016-bar"></div>
                    </div>
                    <div class="barkey">
                        <div class="bad-number" id="bad-number-2017"></div>
                        <div class="bar" id="bad-days-2017-bar"></div>
                    </div>
                    <!--<div class="barkey">-->
                    <!--    <div class="bad-number" id="bad-number-2018"></div>-->
                    <!--    <div class="bar" id="bad-days-2018-bar"></div>-->
                    <!--</div>-->
                </div>
                <div class="sparklines-container">
                    <div class="spacer-block month-labels">
                        <p>Jan</p>
                        <p>Feb</p>
                        <p>Mar</p>
                        <p>Apr</p>
                        <p>May</p>
                        <p>Jun</p>
                        <p>Jul</p>
                        <p>Aug</p>
                        <p>Sept</p>
                        <p>Oct</p>
                        <p>Nov</p>
                        <p>Dec</p>
                    </div>
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2018"></div>-->
                        <div class="sparkline" id="bad-days-2009"></div>
                    </div>
                   
    
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2017"></div>-->
                        <div class="sparkline" id="bad-days-2010"></div>
                        
                    </div>
                    
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2016"></div>-->
                        <div class="sparkline" id="bad-days-2011"></div>
                        
                    </div>
    
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2015"></div>-->
                        <div class="sparkline" id="bad-days-2012"></div>
                        
                    </div>
                    
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2014"></div>-->
                        <div class="sparkline" id="bad-days-2013"></div>
                       
                    </div>
                    
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2013"></div>-->
                        <div class="sparkline" id="bad-days-2014"></div>
                        
                    </div>
                    
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2012"></div>             -->
                        <div class="sparkline" id="bad-days-2015"></div>
                       
                    </div>
                        
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2011"></div>              -->
                        <div class="sparkline" id="bad-days-2016"></div>
                       
                    </div>
                        
                    <div class="sparkey">
                        <!--<div class="bad-number" id="bad-number-2010"></div>              -->
                        <div class="sparkline" id="bad-days-2017"></div>
                       
                    </div>
                    
                    <!--<div class="sparkey">-->
                    <!--    <!--<div class="bad-number" id="bad-number-2009"></div>              -->
                    <!--    <div class="sparkline" id="bad-days-2018"></div>-->
                    <!--    -->
                    <!--</div>-->
                        
                </div>
                <div class="year-label-container">
                    <div class="spacer-block"></div>
                    <div class="year-label">2009</div>
                    <div class="year-label">2010</div>
                    <div class="year-label">2011</div>
                    <div class="year-label">2012</div>
                    <div class="year-label">2013</div>
                    <div class="year-label">2014</div>
                    <div class="year-label">2015</div>
                    <div class="year-label">2016</div>
                    <div class="year-label">2017</div>
                    <!--<div class="year-label">2018</div>-->
                </div>
            </div>
        </div>
        
		<!--<div class="container-12 center">
			<svg id="mmm-2009"></svg>
			<svg id="mmm-2010"></svg>
			<svg id="mmm-2011"></svg>
			<svg id="mmm-2012"></svg>
			<svg id="mmm-2013"></svg>
			<svg id="mmm-2014"></svg>
			<svg id="mmm-2015"></svg>
			<svg id="mmm-2016"></svg>
			<svg id="mmm-2017"></svg>
			<svg id="mmm-2018"></svg>				
			
			<div id="compare-bad-days-chart">
				
			</div>
		</div>-->
    </section>
    <!--<section class="spacer gray"></section>-->
    <section class="section">
        
		<div class="container-14 center">
			
			<div class="radial-charts-container">
				<div class="square">
					<svg id="one" width="200" height="200"></svg>
					<div class="year">2009</div>
					<div class="bad-days-number" id="bad-number-2009">0</div>
					
				</div>
				<div class="square">
					<svg id="two" width="200" height="200"></svg>
					<div class="year">2010</div>
					<div class="bad-days-number" id="bad-number-2010">0</div>
				</div>
				<div class="square">
					<svg id="three" width="200" height="200"></svg>
					<div class="year">2011</div>
					<div class="bad-days-number" id="bad-number-2011">0</div>
				</div>
				<div class="square">
					<svg id="four" width="200" height="200"></svg>
					<div class="year">2012</div>
					<div class="bad-days-number" id="bad-number-2012">0</div>
				</div>
				<div class="square">
					<svg id="five" width="200" height="200"></svg>
					<div class="year">2013</div>
					<div class="bad-days-number" id="bad-number-2013">0</div>
				</div>
				<div class="square">
					<svg id="six" width="200" height="200"></svg>
					<div class="year">2014</div>
					<div class="bad-days-number" id="bad-number-2014">0</div>
				</div>
				<div class="square">
					<svg id="seven" width="200" height="200"></svg>
					<div class="year">2015</div>
					<div class="bad-days-number" id="bad-number-2015">0</div>
				</div>
				<div class="square">
					<svg id="eight" width="200" height="200"></svg>
					<div class="year">2016</div>
					<div class="bad-days-number" id="bad-number-2016">0</div>
				</div>
				<div class="square">
					<svg id="nine" width="200" height="200"></svg>
					<div class="year">2017</div>
					<div class="bad-days-number" id="bad-number-2017">0</div>
				</div>
				<div class="square">
					<svg id="ten" width="200" height="200"></svg>
					<div class="year">2018</div>
					<div class="bad-days-number" id="bad-number-2017">0</div>
				</div>
			</div>
            
            <div class="block-right">
				<h3>
					Yes, it's getting better.
				</h3>
				<p class="paragraph">
					Below is a yearly plot of percentual pm2.5 values in Beijing. There are some white gaps in the data in the first few years; those are invalid readings. A few findings that jump out: 
				</p>
				<ul>
					<li>
						From 2009 to 2012, the air is pretty much problematic year-round.
					</li>
					<li>
						From 2013 to 2016, fall and winter are much worse than spring and summer. March through September are steadily improving.
					</li>
					<li>
						2017 (except for a spike in January) and 2018 are a significant improvement.
					</li>
                    mean amount of pm2.5 per day
					total amount of pm2.5 yearly
					how many cigarettes per day
				</ul>
			</div>
            
		</div>
	</section>
	
	<section class="section">
		<div class="container center">
			<div class="half-width left">
				<div class="block">
					<h3>
						Next: The best time of year to visit Beijing
					</h3>
					<p class="paragraph">
						A deep dive into the best and worst time to be in Beijing throughout the year.
					</p>
				</div>
			</div>
		
			<div class="half-width left">
				<div class="block">
					
				</div>
                                <!-- Begin Mailchimp Signup Form -->
                <link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
                <style type="text/css">
                    #mc_embed_signup{background:#fff; clear:left; /*font:14px Helvetica,Arial,sans-serif;*/ }
                    /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
                       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
                </style>
                <div id="mc_embed_signup">
                <form action="https://fyi.us20.list-manage.com/subscribe/post?u=4f40e5bb4e0be541b8ca3bfc9&amp;id=7895f029d3" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                    <div id="mc_embed_signup_scroll">
                    
                <div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
                <div class="mc-field-group">
                    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
                </label>
                    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
                </div>
                    <div id="mce-responses" class="clear">
                        <div class="response" id="mce-error-response" style="display:none"></div>
                        <div class="response" id="mce-success-response" style="display:none"></div>
                    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_4f40e5bb4e0be541b8ca3bfc9_7895f029d3" tabindex="-1" value=""></div>
                    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                    </div>
                </form>
                </div>
                <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
                <!--End mc_embed_signup-->
<!--				<form method="POST" action="https://formspree.io/hello@seriousness.nl">-->
<!--                    <input type="email" name="email" placeholder="Your email">-->
<!--                    <textarea name="message" placeholder="Test Message"></textarea>-->
<!--                    <button type="submit">Send Test</button>-->
<!--                </form>-->
			</div>
		</div>
	</section>
    <script src="js/jquery-3.4.0.min.js"></script>
	<script src="js/d3.min.js"></script>
	<script src="js/d3-scale-radial.js"></script>
	<script src="js/Chart.min.js"></script>
	<script src="js/multirange.js"></script>
	<script src="js/radial-bar.js"></script>
	<script src="js/line-chart.js"></script>
	<script src="js/min-mean-max-chart.js"></script>
	<script src="js/bad-days.js"></script>
	
	<script>
		// get the bad days first
		var bad_days = function () {
			//initSliders();
		}
		//console.log("bad days: " + bad_days);
		
		draw("data/2009_monthly_inverted_relative.csv", "#one", "");
		draw("data/2010_monthly_inverted_relative.csv", "#two", "");
		draw("data/2011_monthly_inverted_relative.csv", "#three", "");
		draw("data/2012_monthly_inverted_relative.csv", "#four", "");
		draw("data/2013_monthly_inverted_relative.csv", "#five", "");
		draw("data/2014_monthly_inverted_relative.csv", "#six", "");
		draw("data/2015_monthly_inverted_relative.csv", "#seven", "");
		draw("data/2016_monthly_inverted_relative.csv", "#eight", "");
		//draw("data/2017_monthly_inverted_relative.csv", "#nine", "2017");
		draw("data/2017_monthly_inverted_relative_berkeley.csv", "#nine", "");
		draw("data/2018_monthly_inverted_relative_berkeley.csv", "#ten", "");
	</script>
</body>
</html>
